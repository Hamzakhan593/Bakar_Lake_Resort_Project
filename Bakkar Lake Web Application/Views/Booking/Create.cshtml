@model Bakkar_Lake_Web_Application.Models.BookingViewModel;

@{
    ViewData["Title"] = "Create Booking";
}

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-lg">
                <div class="card-header bg-primary text-white">
                    <h3 class="text-center mb-0">Create Booking</h3>
                </div>
                <div class="card-body">
                    <form asp-action="Create" method="post" novalidate>
                        <!-- Customer Information Section -->
                        <h5 class="mb-3">Customer Information</h5>
                        <div class="mb-3">
                            <label for="CustomerName" class="form-label">Customer Name</label>
                            <input type="text" asp-for="CustomerName" class="form-control" placeholder="Enter full name" />
                            <span asp-validation-for="CustomerName" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label for="CustomerPhoneNumber" class="form-label">Phone Number</label>
                            <input type="text" asp-for="CustomerPhoneNumber" class="form-control" placeholder="03XXXXXXXXX" />
                            <span asp-validation-for="CustomerPhoneNumber" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label for="CustomerEmail" class="form-label">Email</label>
                            <input type="email" asp-for="CustomerEmail" class="form-control" placeholder="Enter your email" />
                            <span asp-validation-for="CustomerEmail" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label for="Address" class="form-label">Address</label>
                            <input type="text" asp-for="Address" class="form-control" placeholder="Enter your Address" />
                            <span asp-validation-for="Address" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label for="CustomerCNIC" class="form-label">CNIC</label>
                            <input type="text" asp-for="CustomerCNIC" class="form-control" placeholder="XXXXX-XXXXXXX-X" />
                            <span asp-validation-for="CustomerCNIC" class="text-danger"></span>
                        </div>

                        <hr class="my-4">

                        <!-- Booking Information Section -->
                        <h5 class="mb-3">Booking Information</h5>
                        <div class="form-group">
                            <label for="PackageId">Package</label>
                            <select asp-for="PackageId" class="form-control" asp-items="@(new SelectList(Model.Packages, "P_Id", "PakkageDetail"))" id="PackageId">
                                <option value="">-- Select a Package --</option>
                            </select>
                            <span asp-validation-for="PackageId" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label for="RoomId" class="form-label">Room</label>
                            <select asp-for="RoomId" class="form-select" asp-items="@(new SelectList(Model.Rooms, "RoomId", "RoomType"))">
                                <option value="">-- Select a Room --</option>
                            </select>
                            <span asp-validation-for="RoomId" class="text-danger"></span>
                        </div>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="CheckInDate" class="form-label">Check-In Date</label>
                                <input type="date" asp-for="CheckInDate" placeholder="01/01/2024" class="form-control" min="@DateTime.Now.ToString("yyyy-MM-dd")" />
                                <span asp-validation-for="CheckInDate" class="text-danger"></span>
                            </div>
                            <div class="col-md-6">
                                <label for="CheckOutDate" class="form-label">Check-Out Date</label>
                                <input type="date" asp-for="CheckOutDate" placeholder="01/01/2024" class="form-control" min="@DateTime.Now.AddDays(1).ToString("yyyy-MM-dd")" />
                                <span asp-validation-for="CheckOutDate" class="text-danger"></span>
                            </div>

                            <div class="col-md-4">
                                <label for="TotalDays" class="form-label">Total Days</label>
                                <input type="number" asp-for="TotalDays" class="form-control" id="TotalDays" readonly />
                                <span asp-validation-for="TotalDays" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="row g-3 mt-3">
                            <div class="col-md-6">
                                <label for="Discount" class="form-label">Discount (%)</label>
                                <input type="number" asp-for="Discount" class="form-control" placeholder="Enter discount" />
                                <span asp-validation-for="Discount" class="text-danger"></span>
                            </div>

                            <div class="form-group">
                                <label for="Total">Total Amount</label>
                                <input type="number" asp-for="Total" class="form-control" id="Total" readonly />
                                <span asp-validation-for="Total" class="text-danger"></span>
                            </div>

                            @* <div class="form-group">
                                <label>Total Amount</label>
                                <input type="text" id="totalAmount" class="form-control" readonly />
                            </div> *@
                      @*       <div class="col-md-6">
                                <label for="Total" class="form-label">Total Amount</label>
                                <input type="number" asp-for="Total" class="form-control" placeholder="Enter total amount" />
                                <span asp-validation-for="Total" class="text-danger"></span>
                            </div> *@
                        </div>

                        @* <div class="form-check form-switch mt-4">
                            <input class="form-check-input" asp-for="Status" type="checkbox" />
                            <label class="form-check-label" for="Status">Active</label>
                        </div> *@

                        <div class="d-grid mt-4">
                            <button type="submit" class="btn btn-primary btn-lg">Submit Booking</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const checkInDateField = document.getElementById("CheckInDate");
                const checkOutDateField = document.getElementById("CheckOutDate");
                const totalDaysField = document.getElementById("TotalDays");
                const totalField = document.getElementById("Total");

                // Event listeners to calculate total days and total amount when dates change
                checkInDateField.addEventListener("change", updateBookingDetails);
                checkOutDateField.addEventListener("change", updateBookingDetails);

                function updateBookingDetails() {
                    const checkInDate = new Date(checkInDateField.value);
                    const checkOutDate = new Date(checkOutDateField.value);

                    // Calculate total days
                    const totalDays = (checkOutDate - checkInDate) / (1000 * 3600 * 24);
                    totalDaysField.value = totalDays;

                    // Recalculate total amount if package is selected
                    const packageId = document.getElementById("PackageId").value;
                    if (packageId && totalDays > 0) {
                        fetch(`/Booking/GetPackageTotalPrice?id=${packageId}`)
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    totalField.value = data.totalPrice * totalDays; // Update total amount
                                }
                            })
                            .catch(error => console.error("Error calculating total amount:", error));
                    }
                }
            });
        </script>
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
